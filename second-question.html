<!DOCTYPE html>
<html lang="en">
<head>
  <title>Second question</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="second.css">

  <style>
  .axis path,
  .axis line {
    fill: none;
    stroke: black;
    shape-rendering: crispEdges;
  }

  .axis text {
      font-family: sans-serif;
      font-size: 11px;
  }
      .heatmap{
          text-align: center;
        /*top:110px;*/
        position: relative;
    }

    /* Set height of the grid so .sidenav can be 100% (adjust as needed) */
    .row.content {height: 800px}

    /* Set gray background color and 100% height */
    .sidenav {
      padding-top: 20px;
      background-color: #8e7f7f;
      height: 1000px;
    }

    /* On small screens, set height to 'auto' for sidenav and grid */
    @media screen and (max-width: 767px) {
      .sidenav {
        height: auto;
        padding: 0px;
      }
      .row.content {height:auto;}
    }
  </style>
	</head>
	<body>
  <h1>Second Question:</h1>
  <h2>are the art historians studying renaissance also studying those artistic periods? </h2>
  <p>here goes explanation</p>
  <div class="heatmap"></div>

  <script src="https://d3js.org/d3.v4.min.js"></script>

<script>

    /*

    negative color scales in increasing magnitude
    #EF9FAE, #C76475, #781426

    positive color scales in increasing magnitude
    #cbbcb1, #898b8a, #41444b

    */

    /* supporting functions */

    // Standard deviation
    function RMS(arr){
        return Math.pow(arr.reduce(function(acc,pres){
            return acc+ Math.pow(pres,2);
        })/arr.length,.5)
    }

    // mean
    function mean(arr){
        return arr.reduce(function(acc,prev){
            return acc+prev;
        })/arr.length;
    }

  var lPatchWidth=200;
  var itemSize = 22,
      cellSize = itemSize - 3,
      margin = {top: 50, right: 20, bottom: 120, left: 200};

    var data;

  var width = 750 - margin.right - margin.left,
      height = 900 - margin.top - margin.bottom;
  var colorScale;

  colorHold=["#781426","#C76475","#EF9FAE","  #cbbcb1","#898b8a","#41444b"]
  /*colorLText=["< -66%","-66% to -33%","-33% to 0%","0% to 33%","33% to 66%","> 66%"]*/
    colorLText=["< 1","2 to 4","5","6","6 to 8","9"]

  function bandClassifier(val,multiplier)
  {
        if(val>=0)
        {
            return (Math.floor((val*multiplier)/(.33*multiplier))+1)>3?3:Math.floor((val*multiplier)/(.33*multiplier))+1
        }
        else{
            return (Math.floor((val*multiplier)/(.33*multiplier)))<-3?-3:Math.floor((val*multiplier)/(.33*multiplier))
        }
  }


  window.onload=function(){
      d3.csv('correct.csv', function ( response ) {

    data = response.map(function( item ) {
        var newItem = {};
        newItem.country = item.x;
        newItem.product = item.y;
        newItem.value = +item.value;

        return newItem;
    })


    invertcolors=0;
    // Inverting color scale
    if(invertcolors){
        colorHold.reverse();


    }

    var x_elements = d3.set(data.map(function( item ) { return item.product; } )).values(),
        y_elements = d3.set(data.map(function( item ) { return item.country; } )).values();

    var xScale = d3.scaleBand()
        .domain(x_elements)
        .range([0, x_elements.length * itemSize])
        .paddingInner(20).paddingOuter(cellSize/2)

    var xAxis = d3.axisBottom()
        .scale(xScale)
    .tickSizeOuter(0)
        .tickFormat(function (d) {
            return d;
        });

    var yScale = d3.scaleBand()
        .domain(y_elements)
        .range([0, y_elements.length * itemSize])
        .paddingInner(.2).paddingOuter(.2);

    var yAxis = d3.axisLeft()
        .scale(yScale)
        .tickFormat(function (d) {
            return d;
        });


    // Finding the mean of the data
    var mean=window.mean(data.map(function(d){return +d.value}));

    //setting percentage change for value w.r.t average
    data.forEach(function(d){
        d.perChange=(d.value-mean)/mean
    })

    colorScale = d3.scaleOrdinal()
        .domain([-3,-2,-1,1,2,3])
        .range(colorHold);

    var rootsvg = d3.select('.heatmap')
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
    var svg=rootsvg.append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    // tooltip
    tooltip=d3.select("body").append("div").style("width","80px").style("height","40px").style("background","#C3B3E5")
    .style("opacity","1").style("position","absolute").style("visibility","hidden").style("box-shadow","0px 0px 6px #7861A5").style("padding","10px");
    toolval=tooltip.append("div");


    var cells = svg.selectAll('rect')
        .data(data)
        .enter().append('g').append('rect')
        .attr('class', 'cell')
        .attr('width', cellSize)
        .attr('height', cellSize)
        .attr('y', function(d) { return yScale(d.country); })
        .attr('x', function(d) { return xScale(d.product)-cellSize/2; })
        .attr('fill', function(d) {
            if(d.value == 0){
                d = null;
            }
             if (d !== null) return colorScale(window.bandClassifier(d.perChange,100));
             else return "url(#diagonalHatch)";
        })
        .attr("rx",3)
        .attr("ry",3)
        .on("mouseover",function(d){
            console.log(d);
            //d3.select(this).attr("fill","#655091");
            d3.select(this).style("stroke","orange").style("stroke-width","3px")
            //d3.select(".trianglepointer").transition().delay(100).attr("transform","translate("+(-((lPatchWidth/colorScale.range().length)/2+(colorScale.domain().indexOf(bandClassifier(d.perChange,100))*(lPatchWidth/colorScale.range().length) )))+",0)");
            //d3.select(".trianglepointer").transition().delay(100).attr("transform","translate("+d+",0)")
            d3.select(".trianglepointer").transition().delay(100).attr("transform","translate("+(-((lPatchWidth/colorScale.range().length)/2+(colorScale.domain().indexOf(bandClassifier(d.perChange,100))*(lPatchWidth/colorScale.range().length) )))+",0)");
            d3.select(".LegText").select("text").text(colorLText[colorScale.domain().indexOf(bandClassifier(d.perChange,100))])


        })
        .on("mouseout",function(){
            //d3.select(this).attr('fill', function(d) { return colorScale(window.bandClassifier(d.perChange,100));});
            d3.select(this).style("stroke","none");
            tooltip.style("visibility","hidden");
        })
        .on("mousemove",function(d){
            tooltip.style("visibility","visible")
            .style("top",(d3.event.pageY-30)+"px").style("left",(d3.event.pageX+20)+"px");

            console.log(d3.mouse(this)[0])
            tooltip.select("div").html("<strong>"+d.product+"</strong><br/> "+(+d.value).toFixed(2))

        })


    svg.append("g")
        .attr("class", "y axis")
        .call(yAxis)
        .selectAll('text')
        .attr('font-weight', 'normal');

    svg.append("g")
        .attr("class", "x axis")
        .attr("transform","translate(0,"+(y_elements.length * itemSize +cellSize/2)+")")
        .call(xAxis)
        .selectAll('text')
        .attr('font-weight', 'normal')
        .style("text-anchor", "end")
        .attr("dx", "-.8em")
        .attr("dy", "-.5em")
        .attr("transform", function (d) {
            return "rotate(-65)";
        });

    // Legends section
          svg.append('defs')
              .append('pattern')
              .attr('id', 'diagonalHatch')
              .attr('patternUnits', 'userSpaceOnUse')
              .attr('width', 4)
              .attr('height', 4)
              .append('path')
              .attr('d', 'M-1,1 l2,-2 M0,4 l4,-4 M3,5 l2,-2')
              .attr('stroke', '#000000')
              .attr('stroke-width', 1);

    legends=svg.append("g").attr("class","legends")
    .attr("transform","translate("+((width+margin.right)/2-lPatchWidth/2 -margin.left/2)+","+(height+margin.bottom-35-20)+")");

    // Legend traingle pointer generator
    var symbolGenerator = d3.symbol()
    .type(d3.symbolTriangle)
    .size(64);

    legends.append("g").attr("transform","rotate(180)").append("g").attr("class","trianglepointer")
    .attr("transform","translate("+(-lPatchWidth/colorScale.range().length)/2+")")
    .append("path").attr("d",symbolGenerator());
    //Legend Rectangels
    legends.append("g").attr("class","LegRect")
    .attr("transform","translate(0,"+15+")")
    .selectAll("rect").data(colorScale.range()).enter()
    .append("rect").attr("width",lPatchWidth/colorScale.range().length+"px").attr("height","10px").attr("fill",function(d){ return d})
    .attr("x",function(d,i){ return i*(lPatchWidth/colorScale.range().length) })

    // legend text
    legends.append("g").attr("class","LegText")
    .attr("transform","translate(0,45)")
    .append("text")
    .attr("x",lPatchWidth/2)
    .attr('font-weight', 'normal')
    .style("text-anchor", "middle")
    .text(colorLText[0])

    // Heading
    rootsvg.append("g")
    .attr("transform","translate(0,30)")
    .append("text")
    .attr("x",(width+margin.right+margin.left)/2)
    .attr('font-weight', 'bold')
    .attr('font-size', '22px')
    .attr('font-family', 'Segoe UI bold')
    .style("text-anchor", "middle")
    .text("Heatmap")


  });
  }
</script>
		<div class="table">
  <style type="text/css">
 .tg  {border-collapse:collapse;border-spacing:0;}
 .tg td{border-color:#8e7f7f;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;
   overflow:hidden;padding:10px 5px;word-break:normal;}
 .tg th{border-color:#8e7f7f;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;
   font-weight:normal;overflow:hidden;padding:10px 5px;word-break:normal;}
 .tg .tg-wp8o{border-color:#8e7f7f;text-align:center;vertical-align:top}
 .tg .tg-73oq{border-color:#8e7f7f;text-align:left;vertical-align:top}
 </style>
 <table class="tg">
 <thead>
   <tr>
     <th class="tg-73oq">most studies historical period along with renaissance</th>
   </tr>
 </thead>
 <tbody>
   <tr>
     <td class="tg-wp8o"><br><img src="./image/renaissance.jpg" alt="renaissance" width="70" height="70"><br><br><a href="https://www.britannica.com/event/Renaissance" target="_blank" rel="noopener noreferrer">Renaissance</a><br></td>
   </tr>
   <tr>
     <td class="tg-wp8o"><img src="./image/baroque.jpg"  alt="Baroque" width="70" height="70"><br><br><a href="https://en.wikipedia.org/wiki/Baroque" target="_blank" rel="noopener noreferrer">15century</a><br></td>
   </tr>
   <td class="tg-wp8o"><img src="./image/15c.jpg" alt="15th" width="70" height="70"><br><br><a href="https://en.wikipedia.org/wiki/15th_century" target="_blank" rel="noopener noreferrer">15century</a><br></td>
 </tr>
   <tr>
     <td class="tg-wp8o"><img src="./image/16c.jpg" alt="16th" width="70" height="70"><br><br><a href="https://en.wikipedia.org/wiki/16th_century" target="_blank" rel="noopener noreferrer">16th century</a><br></td>
   </tr>
 </tbody>
 </table>
		  	</div>

       

		<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
    
</div>
</body>
</html>

</body>
</html>
