<!DOCTYPE html>
<html lang="en">
<head>
    <title>third question</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="first.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.10.0/d3.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

    <style>

        div.tooltip {
            position: absolute;
            text-align: center;
            padding: 2px;
            font: 12px sans-serif;
            background: lightsteelblue;
            border: 0;
            border-radius: 8px;
            visibility: hidden;
        }
        /* Set height of the grid so .sidenav can be 100% (adjust as needed) */
        .row.content {height: 800px}

        /* Set gray background color and 100% height */
        .sidenav {
            padding-top: 20px;
            background-color: #f1f1f1;
            height: 1000px;
        }

        /* On small screens, set height to 'auto' for sidenav and grid */
        @media screen and (max-width: 767px) {
            .sidenav {
                height: auto;
                padding: 15px;
            }
            .row.content {height:auto;}
        }

        div#my_dataviz {
            width: 585px;
            margin: auto;
        }

        select {
            position: absolute;
            left: 500px;
            background-color: white;
            color: black;
            border: 2px solid #555555;
            padding: 8px 20px;
        }

    </style>


</head>

<body>

<div class="col-sm-10 text-left">
    <div class="first-text" style="margin: auto ; width: 100%;position: unset; padding-top:20px;padding-left:80px;">
        <h1>third Question:</h1>
        <h2> Are there aspects of the Renaissance that have been studied more by historians? </h2>
        <p>On the first level of the analysis the focus is the general trend of study over historians. A pie chart can effectively represents the composition of the 3 main categories of interests: people, artifacts and genres.</p>

        <div id="chart_div" style="width: 700px; height: 300px;"></div>
    </div>
</div>

<!-- js script for the pie chart -->
<script type="text/javascript">

    /*$(document).ready(function()
    {
        $.getJSON("chartData.json", function(data){

            console.log(data);
        }).fail(function(){
            console.log("An error has occurred.");
        });
    });*/

    // Load the Visualization API and the piechart package.
    google.charts.load('current', {'packages':['corechart']});

    // Set a callback to run when the Google Visualization API is loaded.
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
        // Create our data table out of JSON data loaded from server.
        $.getJSON("https://digitalstory33.github.io/Renaissance/chartData.json", function(data){

            var data = new google.visualization.DataTable(data);

            // Instantiate and draw our chart, passing in some options.
            var chart = new google.visualization.PieChart(document.getElementById('chart_div'));
            var options = {
                title: 'Percentage of historians by topic of interest',
                colors: ['#838383', '#ad9d9d', '#fccbcb'],
                is3D: true,
            };
            chart.draw(data, options);
            console.log(data);
        }).fail(function(){
            console.log("An error has occurred.");
        });

    }

</script>








<div class="col-sm-10 text-left">
    <div class="first-text" style="margin: auto ; width: 100%;position: unset; padding-top:20px;padding-left:80px;">
        <p>On the second level of the analysis, the interests are reported for each single art historian.</p>
    </div>
</div>

<!-- div where the bar charts for the single historians will take place -->
<div id="my_dataviz"></div>

<!-- js script for the drop down menu charts for the single historians -->
<script>
    // set the dimensions and margins of the graph
    var margin = {top: 30, right: 30, bottom: 70, left: 60},
        width = 560 - margin.left - margin.right,
        height = 400 - margin.top - margin.bottom;

    // append the svg object to the body of the page
    var svg = d3.select("#my_dataviz")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        // questi due qui sotto non ci sono in SO:
        .append("g")
        .attr("transform",
            "translate(" + margin.left + "," + margin.top + ")");


    // Parse the Data
    d3.csv("new_renaissance_subjects.csv", function(data) {

        // Get the columns.
        var historianNames = data.columns.slice(1);

        // Create a select element
        var select = d3.select("body")
            .append("select")
            .on("change", update)

        // Add an initial option:
        select.append("option")
            .html("Select an art historian:")

        // Add the options:
        var options = select.selectAll(null)
            .data(historianNames)
            .enter()
            .append("option")
            .text(function(d) { return d; });

        // X axis (scale)
        var x = d3.scaleBand()
            .range([ 0, width ])
            .domain(data.map(function(d) { return d.obj_type; }))
            .padding(0.2);

        // Add Y axis (scale)
        var y = d3.scaleLinear()
            .domain([0, 16])
            .range([ height, 0]);

        // Specify an Update function to create and update visualization elements:
        function update() {
            var historianName = this.value; // e.g. Ulrich Middeldorf
            var bars = svg.selectAll("rect").data(data);

            bars.enter()
                .append("rect")
                .attr("x", function(d) { return x(d.obj_type); })
                .attr("width", x.bandwidth())
                .attr("y", 150)
                .attr("height",0)
                .merge(bars)
                .transition()
                .attr("height", function(d) {
                    if (d[historianName] === '0') { return height - y(0); }
                    else {return height - y(d[historianName].split(", ").length || 0);}
                })
                .attr("fill", "#69b3a2")
                .attr("y", function(d) {
                    if (d[historianName] === '0') { return y(0); }
                    else {return y(d[historianName].split(", ").length || 0);}
                });

            svg.append("g")
                .call(d3.axisLeft(y));

            svg.append("g")
                .attr("transform", "translate(0," + height + ")")
                .call(d3.axisBottom(x))
                .selectAll("text")
                .style("text-anchor", "end");

            var div = d3.select("body").append("div")
                .attr("class", "tooltip")
                .style("opacity", 0);

            svg.selectAll("rect")
                .on("mouseover", function(d) {
                    // var x = d3.event.pageX - document.getElementById('my_dataviz').getBoundingClientRect().x + 10;
                    // var y = d3.event.pageY - document.getElementById('my_dataviz').getBoundingClientRect().y + 10;

                    // var textdiv = document.getElementById('text');
                    // textdiv.innerHTML = d[historianName].replace(/, /g, " <br>");

                    div.style('visibility', 'visible')
                        .style("opacity", .9)
                    // .style('top', d3.event.pageY - 10 + 'px')
                    // .style('left', d3.event.pageX + 10 + 'px')
                    // .html(d[historianName].replace(/, /g, " <br>"));

                })
                .on("mousemove", function (d) {
                    // var x = d3.event.pageX - document.getElementById('my_dataviz').getBoundingClientRect().x + 10;
                    // var y = d3.event.pageY - document.getElementById('my_dataviz').getBoundingClientRect().y + 10;

                    div .style('top', d3.event.pageY - 10 + 'px')
                        .style('left', d3.event.pageX + 10 + 'px')
                        .html(d[historianName].replace(/, /g, " <br>"));
                    d3.select(this).attr("fill", "blue");
                })
                .on("mouseout", function() {
                    div.style('visibility', 'hidden')
                        .style("opacity", 0);
                    d3.select(this).attr("fill", "#69b3a2");
                });

        } // end of function update()

    }) // end of the function that parses the csv

</script>


</body>
</html>

